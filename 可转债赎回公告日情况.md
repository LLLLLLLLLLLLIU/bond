```python
from iFinDPy import *
from datetime import datetime
import pandas as pd
import time as _time
import json
from threading import Thread,Lock,Semaphore
import requests
```

    C:\Users\Administrator\anaconda3\Lib\site-packages\iFinDPy.pth
    


```python
THS_iFinDLogin('hxzq2913','347838')
```




    0




```python

```


```python
#基础数据-债券-债券简称;赎回公告日;正股代码;正股简称-iFinD数据接口
raw = THS_BD('100001.SH,100009.SH,100016.SH,100087.SH,100096.SH,100117.SH,100177.SH,100196.SH,100220.SH,100236.SH,100567.SH,100726.SH,100795.SH,110001.SH,110002.SH,110003.SH,110004.SH,110005.SH,110006.SH,110007.SH,110008.SH,110009.SH,110010.SH,110011.SH,110012.SH,110013.SH,110015.SH,110016.SH,110017.SH,110018.SH,110019.SH,110020.SH,110021.SH,110022.SH,110023.SH,110024.SH,110025.SH,110026.SH,110027.SH,110028.SH,110029.SH,110030.SH,110031.SH,110032.SH,110033.SH,110034.SH,110035.SH,110036.SH,110037.SH,110039.SH,110040.SH,110041.SH,110042.SH,110046.SH,110049.SH,110050.SH,110051.SH,110054.SH,110065.SH,110066.SH,110069.SH,110078.SH,110219.SH,110227.SH,110232.SH,110317.SH,110325.SH,110368.SH,110398.SH,110418.SH,110423.SH,110488.SH,110567.SH,110598.SH,110800.SH,110802.SH,110804.SH,110805.SH,110806.SH,110809.SH,110810.SH,110812.SH,110874.SH,110971.SH,113001.SH,113002.SH,113003.SH,113005.SH,113006.SH,113007.SH,113008.SH,113009.SH,113010.SH,113012.SH,113014.SH,113015.SH,113018.SH,113019.SH,113020.SH,113022.SH,113026.SH,113028.SH,113029.SH,113031.SH,113032.SH,113034.SH,113035.SH,113036.SH,113038.SH,113040.SH,113041.SH,113501.SH,113503.SH,113506.SH,113507.SH,113508.SH,113509.SH,113510.SH,113511.SH,113512.SH,113513.SH,113514.SH,113515.SH,113517.SH,113518.SH,113520.SH,113521.SH,113522.SH,113523.SH,113528.SH,113529.SH,113531.SH,113533.SH,113536.SH,113538.SH,113539.SH,113540.SH,113543.SH,113544.SH,113547.SH,113550.SH,113551.SH,113552.SH,113553.SH,113554.SH,113555.SH,113556.SH,113557.SH,113558.SH,113559.SH,113562.SH,113564.SH,113571.SH,113572.SH,113580.SH,113581.SH,113583.SH,113586.SH,113587.SH,113590.SH,113592.SH,113603.SH,113607.SH,113611.SH,113612.SH,113614.SH,117103.SZ,118002.SH,121001.SZ,121002.SZ,121003.SZ,123001.SZ,123003.SZ,123005.SZ,123006.SZ,123007.SZ,123008.SZ,123009.SZ,123016.SZ,123017.SZ,123019.SZ,123020.SZ,123021.SZ,123024.SZ,123026.SZ,123028.SZ,123030.SZ,123032.SZ,123033.SZ,123036.SZ,123037.SZ,123040.SZ,123041.SZ,123042.SZ,123043.SZ,123047.SZ,123051.SZ,123053.SZ,123055.SZ,123058.SZ,123066.SZ,123068.SZ,123069.SZ,123074.SZ,123079.SZ,123081.SZ,123094.SZ,123102.SZ,123111.SZ,124001.SZ,124003.SZ,124007.SZ,124008.SZ,124009.SZ,124010.SZ,124011.SZ,124013.SZ,124016.SZ,124019.SZ,124022.SZ,125002.SZ,125009.SZ,125024.SZ,125069.SZ,125089.SZ,125301.SZ,125302.SZ,125488.SZ,125528.SZ,125572.SZ,125629.SZ,125630.SZ,125709.SZ,125717.SZ,125729.SZ,125731.SZ,125822.SZ,125887.SZ,125898.SZ,125930.SZ,125932.SZ,125936.SZ,125937.SZ,125959.SZ,125960.SZ,125969.SZ,126002.SZ,126301.SZ,126630.SZ,126729.SZ,127001.SZ,127002.SZ,127008.SZ,127009.SZ,127010.SZ,127011.SZ,127023.SZ,128001.SZ,128002.SZ,128003.SZ,128004.SZ,128005.SZ,128006.SZ,128007.SZ,128008.SZ,128009.SZ,128010.SZ,128011.SZ,128012.SZ,128016.SZ,128018.SZ,128019.SZ,128020.SZ,128024.SZ,128027.SZ,128028.SZ,128031.SZ,128032.SZ,128038.SZ,128043.SZ,128045.SZ,128047.SZ,128050.SZ,128051.SZ,128052.SZ,128054.SZ,128055.SZ,128057.SZ,128058.SZ,128059.SZ,128060.SZ,128061.SZ,128064.SZ,128065.SZ,128067.SZ,128068.SZ,128077.SZ,128080.SZ,128084.SZ,128086.SZ,128088.SZ,128089.SZ,128092.SZ,128093.SZ,128094.SZ,128096.SZ,128098.SZ,128099.SZ,128102.SZ,128103.SZ,128104.SZ,128110.SZ,128112.SZ,128113.SZ,128115.SZ,128126.SZ,128233.SZ,129031.SZ,145900.SH,145901.SH,145951.SH,300001.00,300002.00,300003.00,300013.00,300015.00,300020.00,300023.00,58000101.00,58000102.00,58000103.00,58000104.00,58000201.00,58000202.00,58000302.00,800006.00,800007.00,800008.00,900050.00,900051.00,900052.00,S1502631.00,S1503971.00,S1749760.00,S1982498.00,S1982508.00,S1985062.00,S2009751.00,S2014768.00,S2014770.00,S2030578.00,S2030579.00,S2119021.00,S2119025.00,S2127440.00,S2127444.00',
       'ths_bond_short_name_bond;ths_redemp_ad_cbond;ths_stock_code_cbond;ths_stock_short_name_cbond',';;;')
```


```python
bond = raw.data
```


```python
bond.columns = ['可转债代码','可转债简称','日期','正股代码','正股简称']
```


```python
bond['日期'] = pd.to_datetime(bond['日期'])
```


```python
bond1 = bond.dropna(subset=['日期'])
```


```python
bond1=bond1.sort_values('日期',ascending=False)
bond1
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>可转债代码</th>
      <th>可转债简称</th>
      <th>日期</th>
      <th>正股代码</th>
      <th>正股简称</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>140</th>
      <td>113550.SH</td>
      <td>常汽转债</td>
      <td>2022-04-01</td>
      <td>603035.SH</td>
      <td>常熟汽饰</td>
    </tr>
    <tr>
      <th>167</th>
      <td>118002.SH</td>
      <td>天合转债</td>
      <td>2022-03-25</td>
      <td>688599.SH</td>
      <td>天合光能</td>
    </tr>
    <tr>
      <th>107</th>
      <td>113036.SH</td>
      <td>宁建转债</td>
      <td>2022-03-21</td>
      <td>601789.SH</td>
      <td>宁波建工</td>
    </tr>
    <tr>
      <th>183</th>
      <td>123024.SZ</td>
      <td>岱勒转债</td>
      <td>2022-03-08</td>
      <td>300700.SZ</td>
      <td>岱勒新材</td>
    </tr>
    <tr>
      <th>59</th>
      <td>110066.SH</td>
      <td>盛屯转债</td>
      <td>2022-03-02</td>
      <td>600711.SH</td>
      <td>盛屯矿业</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>239</th>
      <td>125930.SZ</td>
      <td>丰原转债</td>
      <td>2006-02-09</td>
      <td>000930.SZ</td>
      <td>中粮科技</td>
    </tr>
    <tr>
      <th>223</th>
      <td>125069.SZ</td>
      <td>侨城转债</td>
      <td>2005-03-10</td>
      <td>000069.SZ</td>
      <td>华侨城A</td>
    </tr>
    <tr>
      <th>1</th>
      <td>100009.SH</td>
      <td>机场转债</td>
      <td>2004-04-14</td>
      <td>600009.SH</td>
      <td>上海机场</td>
    </tr>
    <tr>
      <th>220</th>
      <td>125002.SZ</td>
      <td>万科转债</td>
      <td>2004-03-09</td>
      <td>000002.SZ</td>
      <td>万科A</td>
    </tr>
    <tr>
      <th>230</th>
      <td>125629.SZ</td>
      <td>钢钒转债</td>
      <td>2004-02-12</td>
      <td>000629.SZ</td>
      <td>攀钢钒钛</td>
    </tr>
  </tbody>
</table>
<p>272 rows × 5 columns</p>
</div>




```python

```


```python
#日期序列-指数-涨跌幅-iFinD数据接口
zz500 = THS_DS('000905.SH','ths_chg_ratio_index','','Days:Alldays,block:history','2004-041-01','2022-05-30')
```


```python
zz500 = zz500.data
```


```python
zz500_1 = zz500.drop(columns=['thscode'])
```


```python
zz500_1.columns = ['日期','中证500涨跌幅']
```


```python
zz500_1['日期'] = pd.to_datetime(zz500_1['日期'])
```


```python
mer1 = pd.merge(bond1,zz500_1,on=['日期'],suffixes=('', '_y'))
```


```python
mer1    # 问题：合并中证指数后，数据从272条缩到183条,赎回公告日期的重复项被删除了
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>可转债代码</th>
      <th>可转债简称</th>
      <th>日期</th>
      <th>正股代码</th>
      <th>正股简称</th>
      <th>中证500涨跌幅</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>113550.SH</td>
      <td>常汽转债</td>
      <td>2022-04-01</td>
      <td>603035.SH</td>
      <td>常熟汽饰</td>
      <td>0.625454</td>
    </tr>
    <tr>
      <th>1</th>
      <td>118002.SH</td>
      <td>天合转债</td>
      <td>2022-03-25</td>
      <td>688599.SH</td>
      <td>天合光能</td>
      <td>-1.196028</td>
    </tr>
    <tr>
      <th>2</th>
      <td>113036.SH</td>
      <td>宁建转债</td>
      <td>2022-03-21</td>
      <td>601789.SH</td>
      <td>宁波建工</td>
      <td>0.422070</td>
    </tr>
    <tr>
      <th>3</th>
      <td>123024.SZ</td>
      <td>岱勒转债</td>
      <td>2022-03-08</td>
      <td>300700.SZ</td>
      <td>岱勒新材</td>
      <td>-3.446283</td>
    </tr>
    <tr>
      <th>4</th>
      <td>110066.SH</td>
      <td>盛屯转债</td>
      <td>2022-03-02</td>
      <td>600711.SH</td>
      <td>盛屯矿业</td>
      <td>0.017394</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>178</th>
      <td>110032.SH</td>
      <td>三一转债</td>
      <td>2019-03-05</td>
      <td>600031.SH</td>
      <td>三一重工</td>
      <td>2.656738</td>
    </tr>
    <tr>
      <th>179</th>
      <td>113010.SH</td>
      <td>江南转债</td>
      <td>2019-01-25</td>
      <td>601199.SH</td>
      <td>江南水务</td>
      <td>-0.454761</td>
    </tr>
    <tr>
      <th>180</th>
      <td>123005.SZ</td>
      <td>万信转债</td>
      <td>2018-07-17</td>
      <td>300168.SZ</td>
      <td>万达信息</td>
      <td>0.019191</td>
    </tr>
    <tr>
      <th>181</th>
      <td>110039.SH</td>
      <td>宝信转债</td>
      <td>2018-06-13</td>
      <td>600845.SH</td>
      <td>宝信软件</td>
      <td>-1.516314</td>
    </tr>
    <tr>
      <th>182</th>
      <td>128011.SZ</td>
      <td>汽模转债</td>
      <td>2017-07-18</td>
      <td>002510.SZ</td>
      <td>天汽模</td>
      <td>1.054632</td>
    </tr>
  </tbody>
</table>
<p>183 rows × 6 columns</p>
</div>




```python

```


```python
#日期序列-债券-转债简称;正股代码;正股简称;涨跌幅;正股涨跌幅;转股溢价率;债券余额-iFinD数据接口
raw2 = THS_DS('100001.SH,100009.SH,100016.SH,100087.SH,100096.SH,100117.SH,100177.SH,100196.SH,100220.SH,100236.SH,100567.SH,100726.SH,100795.SH,110001.SH,110002.SH,110003.SH,110004.SH,110005.SH,110006.SH,110007.SH,110008.SH,110009.SH,110010.SH,110011.SH,110012.SH,110013.SH,110015.SH,110016.SH,110017.SH,110018.SH,110019.SH,110020.SH,110021.SH,110022.SH,110023.SH,110024.SH,110025.SH,110026.SH,110027.SH,110028.SH,110029.SH,110030.SH,110031.SH,110032.SH,110033.SH,110034.SH,110035.SH,110036.SH,110037.SH,110039.SH,110040.SH,110041.SH,110042.SH,110046.SH,110049.SH,110050.SH,110051.SH,110054.SH,110065.SH,110066.SH,110069.SH,110078.SH,110219.SH,110227.SH,110232.SH,110317.SH,110325.SH,110368.SH,110398.SH,110418.SH,110423.SH,110488.SH,110567.SH,110598.SH,110800.SH,110802.SH,110804.SH,110805.SH,110806.SH,110809.SH,110810.SH,110812.SH,110874.SH,110971.SH,113001.SH,113002.SH,113003.SH,113005.SH,113006.SH,113007.SH,113008.SH,113009.SH,113010.SH,113012.SH,113014.SH,113015.SH,113018.SH,113019.SH,113020.SH,113022.SH,113026.SH,113028.SH,113029.SH,113031.SH,113032.SH,113034.SH,113035.SH,113036.SH,113038.SH,113040.SH,113041.SH,113501.SH,113503.SH,113506.SH,113507.SH,113508.SH,113509.SH,113510.SH,113511.SH,113512.SH,113513.SH,113514.SH,113515.SH,113517.SH,113518.SH,113520.SH,113521.SH,113522.SH,113523.SH,113528.SH,113529.SH,113531.SH,113533.SH,113536.SH,113538.SH,113539.SH,113540.SH,113543.SH,113544.SH,113547.SH,113550.SH,113551.SH,113552.SH,113553.SH,113554.SH,113555.SH,113556.SH,113557.SH,113558.SH,113559.SH,113562.SH,113564.SH,113571.SH,113572.SH,113580.SH,113581.SH,113583.SH,113586.SH,113587.SH,113590.SH,113592.SH,113603.SH,113607.SH,113611.SH,113612.SH,113614.SH,117103.SZ,118002.SH,121001.SZ,121002.SZ,121003.SZ,123001.SZ,123003.SZ,123005.SZ,123006.SZ,123007.SZ,123008.SZ,123009.SZ,123016.SZ,123017.SZ,123019.SZ,123020.SZ,123021.SZ,123024.SZ,123026.SZ,123028.SZ,123030.SZ,123032.SZ,123033.SZ,123036.SZ,123037.SZ,123040.SZ,123041.SZ,123042.SZ,123043.SZ,123047.SZ,123051.SZ,123053.SZ,123055.SZ,123058.SZ,123066.SZ,123068.SZ,123069.SZ,123074.SZ,123079.SZ,123081.SZ,123094.SZ,123102.SZ,123111.SZ,124001.SZ,124003.SZ,124007.SZ,124008.SZ,124009.SZ,124010.SZ,124011.SZ,124013.SZ,124016.SZ,124019.SZ,124022.SZ,125002.SZ,125009.SZ,125024.SZ,125069.SZ,125089.SZ,125301.SZ,125302.SZ,125488.SZ,125528.SZ,125572.SZ,125629.SZ,125630.SZ,125709.SZ,125717.SZ,125729.SZ,125731.SZ,125822.SZ,125887.SZ,125898.SZ,125930.SZ,125932.SZ,125936.SZ,125937.SZ,125959.SZ,125960.SZ,125969.SZ,126002.SZ,126301.SZ,126630.SZ,126729.SZ,127001.SZ,127002.SZ,127008.SZ,127009.SZ,127010.SZ,127011.SZ,127023.SZ,128001.SZ,128002.SZ,128003.SZ,128004.SZ,128005.SZ,128006.SZ,128007.SZ,128008.SZ,128009.SZ,128010.SZ,128011.SZ,128012.SZ,128016.SZ,128018.SZ,128019.SZ,128020.SZ,128024.SZ,128027.SZ,128028.SZ,128031.SZ,128032.SZ,128038.SZ,128043.SZ,128045.SZ,128047.SZ,128050.SZ,128051.SZ,128052.SZ,128054.SZ,128055.SZ,128057.SZ,128058.SZ,128059.SZ,128060.SZ,128061.SZ,128064.SZ,128065.SZ,128067.SZ,128068.SZ,128077.SZ,128080.SZ,128084.SZ,128086.SZ,128088.SZ,128089.SZ,128092.SZ,128093.SZ,128094.SZ,128096.SZ,128098.SZ,128099.SZ,128102.SZ,128103.SZ,128104.SZ,128110.SZ,128112.SZ,128113.SZ,128115.SZ,128126.SZ,128233.SZ,129031.SZ,145900.SH,145901.SH,145951.SH,300001.00,300002.00,300003.00,300013.00,300015.00,300020.00,300023.00,58000101.00,58000102.00,58000103.00,58000104.00,58000201.00,58000202.00,58000302.00,800006.00,800007.00,800008.00,900050.00,900051.00,900052.00,S1502631.00,S1503971.00,S1749760.00,S1982498.00,S1982508.00,S1985062.00,S2009751.00,S2014768.00,S2014770.00,S2030578.00,S2030579.00,S2119021.00,S2119025.00,S2127440.00,S2127444.00',
       'ths_convertible_debt_short_name_cbond;ths_stock_code_cbond;ths_stock_short_name_cbond;ths_chg_ratio_bond;ths_stock_chg_ratio_cbond;ths_conversion_premium_rate_cbond;ths_bond_balance_bond',';;;103;;;','Fill:Blank','2022-01-25','2022-01-25')
#没有权限提取足够数据，以20220125作为测试
```


```python
timeser = raw2.data
```


```python
timeser.columns = ['日期','可转债代码','可转债简称','正股代码','正股简称','可转债涨跌幅','正股涨跌幅','转股溢价率','债券余额']
```


```python
timeser['日期'] = pd.to_datetime(timeser['日期'])
```


```python
timeser.head(20)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>日期</th>
      <th>可转债代码</th>
      <th>可转债简称</th>
      <th>正股代码</th>
      <th>正股简称</th>
      <th>可转债涨跌幅</th>
      <th>正股涨跌幅</th>
      <th>转股溢价率</th>
      <th>债券余额</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2022-01-25</td>
      <td>100001.SH</td>
      <td>南化转债</td>
      <td>600301.SH</td>
      <td>南化股份</td>
      <td>NaN</td>
      <td>-5.007474</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2022-01-25</td>
      <td>100009.SH</td>
      <td>机场转债</td>
      <td>600009.SH</td>
      <td>上海机场</td>
      <td>NaN</td>
      <td>-0.630613</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2022-01-25</td>
      <td>100016.SH</td>
      <td>民生转债</td>
      <td>600016.SH</td>
      <td>民生银行</td>
      <td>NaN</td>
      <td>-1.515152</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2022-01-25</td>
      <td>100087.SH</td>
      <td>水运转债</td>
      <td>601975.SH</td>
      <td>招商南油</td>
      <td>NaN</td>
      <td>-3.571429</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2022-01-25</td>
      <td>100096.SH</td>
      <td>云化转债</td>
      <td>600096.SH</td>
      <td>云天化</td>
      <td>NaN</td>
      <td>-4.241436</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2022-01-25</td>
      <td>100117.SH</td>
      <td>西钢转债</td>
      <td>600117.SH</td>
      <td>西宁特钢</td>
      <td>NaN</td>
      <td>-4.738155</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2022-01-25</td>
      <td>100177.SH</td>
      <td>雅戈转债</td>
      <td>600177.SH</td>
      <td>雅戈尔</td>
      <td>NaN</td>
      <td>-1.749271</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2022-01-25</td>
      <td>100196.SH</td>
      <td>复星转债</td>
      <td>600196.SH</td>
      <td>复星医药</td>
      <td>NaN</td>
      <td>-5.620805</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>2022-01-25</td>
      <td>100220.SH</td>
      <td>阳光转债</td>
      <td>600220.SH</td>
      <td>江苏阳光</td>
      <td>NaN</td>
      <td>-4.705882</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2022-01-25</td>
      <td>100236.SH</td>
      <td>桂冠转债</td>
      <td>600236.SH</td>
      <td>桂冠电力</td>
      <td>NaN</td>
      <td>-4.280822</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>2022-01-25</td>
      <td>100567.SH</td>
      <td>山鹰转债</td>
      <td>600567.SH</td>
      <td>山鹰国际</td>
      <td>NaN</td>
      <td>-2.484472</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>2022-01-25</td>
      <td>100726.SH</td>
      <td>华电转债</td>
      <td>600726.SH</td>
      <td>*ST华源</td>
      <td>NaN</td>
      <td>-5.349794</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>2022-01-25</td>
      <td>100795.SH</td>
      <td>国电转债</td>
      <td>600795.SH</td>
      <td>国电电力</td>
      <td>NaN</td>
      <td>-7.394366</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>2022-01-25</td>
      <td>110001.SH</td>
      <td>邯钢转债</td>
      <td>600001.SH</td>
      <td>邯郸钢铁</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>14</th>
      <td>2022-01-25</td>
      <td>110002.SH</td>
      <td>南山转债</td>
      <td>600219.SH</td>
      <td>南山铝业</td>
      <td>NaN</td>
      <td>-2.603037</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>15</th>
      <td>2022-01-25</td>
      <td>110003.SH</td>
      <td>新钢转债</td>
      <td>600782.SH</td>
      <td>新钢股份</td>
      <td>NaN</td>
      <td>-4.391892</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>16</th>
      <td>2022-01-25</td>
      <td>110004.SH</td>
      <td>厦工转债</td>
      <td>600815.SH</td>
      <td>厦工股份</td>
      <td>NaN</td>
      <td>-4.530744</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>17</th>
      <td>2022-01-25</td>
      <td>110005.SH</td>
      <td>西洋转债</td>
      <td>600558.SH</td>
      <td>大西洋</td>
      <td>NaN</td>
      <td>-4.558405</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>18</th>
      <td>2022-01-25</td>
      <td>110006.SH</td>
      <td>龙盛转债</td>
      <td>600352.SH</td>
      <td>浙江龙盛</td>
      <td>NaN</td>
      <td>-3.715170</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>19</th>
      <td>2022-01-25</td>
      <td>110007.SH</td>
      <td>博汇转债</td>
      <td>600966.SH</td>
      <td>博汇纸业</td>
      <td>NaN</td>
      <td>-4.089980</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>




```python
mer = pd.merge(mer1, timeser, on=['日期','可转债简称'],how='inner', suffixes=('', '_y'))
```


```python
 mer.drop(columns=['可转债代码_y','正股代码_y','正股简称_y'])
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>可转债代码</th>
      <th>可转债简称</th>
      <th>日期</th>
      <th>正股代码</th>
      <th>正股简称</th>
      <th>中证500涨跌幅</th>
      <th>可转债涨跌幅</th>
      <th>正股涨跌幅</th>
      <th>转股溢价率</th>
      <th>债券余额</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>123042.SZ</td>
      <td>银河转债</td>
      <td>2022-01-25</td>
      <td>300619.SZ</td>
      <td>金银河</td>
      <td>-3.371267</td>
      <td>-11.666667</td>
      <td>-7.042870</td>
      <td>7.866431</td>
      <td>0.972633</td>
    </tr>
    <tr>
      <th>1</th>
      <td>123111.SZ</td>
      <td>东财转3</td>
      <td>2022-01-25</td>
      <td>300059.SZ</td>
      <td>东方财富</td>
      <td>-3.371267</td>
      <td>-3.006928</td>
      <td>-2.669531</td>
      <td>-0.033733</td>
      <td>139.923249</td>
    </tr>
    <tr>
      <th>2</th>
      <td>127011.SZ</td>
      <td>中鼎转2</td>
      <td>2022-01-25</td>
      <td>000887.SZ</td>
      <td>中鼎股份</td>
      <td>-3.371267</td>
      <td>-3.057381</td>
      <td>-1.678141</td>
      <td>-1.469771</td>
      <td>10.104325</td>
    </tr>
    <tr>
      <th>3</th>
      <td>128096.SZ</td>
      <td>奥瑞转债</td>
      <td>2022-01-25</td>
      <td>002701.SZ</td>
      <td>奥瑞金</td>
      <td>-3.371267</td>
      <td>-8.573562</td>
      <td>-4.928458</td>
      <td>-0.503344</td>
      <td>5.600138</td>
    </tr>
    <tr>
      <th>4</th>
      <td>128094.SZ</td>
      <td>星帅转债</td>
      <td>2022-01-25</td>
      <td>002860.SZ</td>
      <td>星帅尔</td>
      <td>-3.371267</td>
      <td>-6.923487</td>
      <td>-4.497817</td>
      <td>-0.749794</td>
      <td>1.762131</td>
    </tr>
    <tr>
      <th>5</th>
      <td>128103.SZ</td>
      <td>同德转债</td>
      <td>2022-01-25</td>
      <td>002360.SZ</td>
      <td>同德化工</td>
      <td>-3.371267</td>
      <td>-9.955257</td>
      <td>-5.529954</td>
      <td>-0.258537</td>
      <td>0.802508</td>
    </tr>
    <tr>
      <th>6</th>
      <td>128113.SZ</td>
      <td>比音转债</td>
      <td>2022-01-25</td>
      <td>002832.SZ</td>
      <td>比音勒芬</td>
      <td>-3.371267</td>
      <td>-3.660141</td>
      <td>-0.084926</td>
      <td>0.425414</td>
      <td>2.813844</td>
    </tr>
  </tbody>
</table>
</div>




```python
mer['正股相对指数超额']=mer['正股涨跌幅']-mer['中证500涨跌幅']
```


```python
order=['日期','可转债代码','可转债简称','正股代码','正股简称','可转债涨跌幅','正股涨跌幅','中证500涨跌幅','正股相对指数超额','转股溢价率','债券余额']
```


```python
mer0=mer[order]
```


```python
mer0
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>日期</th>
      <th>可转债代码</th>
      <th>可转债简称</th>
      <th>正股代码</th>
      <th>正股简称</th>
      <th>可转债涨跌幅</th>
      <th>正股涨跌幅</th>
      <th>中证500涨跌幅</th>
      <th>正股相对指数超额</th>
      <th>转股溢价率</th>
      <th>债券余额</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2022-01-25</td>
      <td>123042.SZ</td>
      <td>银河转债</td>
      <td>300619.SZ</td>
      <td>金银河</td>
      <td>-11.666667</td>
      <td>-7.042870</td>
      <td>-3.371267</td>
      <td>-3.671603</td>
      <td>7.866431</td>
      <td>0.972633</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2022-01-25</td>
      <td>123111.SZ</td>
      <td>东财转3</td>
      <td>300059.SZ</td>
      <td>东方财富</td>
      <td>-3.006928</td>
      <td>-2.669531</td>
      <td>-3.371267</td>
      <td>0.701736</td>
      <td>-0.033733</td>
      <td>139.923249</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2022-01-25</td>
      <td>127011.SZ</td>
      <td>中鼎转2</td>
      <td>000887.SZ</td>
      <td>中鼎股份</td>
      <td>-3.057381</td>
      <td>-1.678141</td>
      <td>-3.371267</td>
      <td>1.693126</td>
      <td>-1.469771</td>
      <td>10.104325</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2022-01-25</td>
      <td>128096.SZ</td>
      <td>奥瑞转债</td>
      <td>002701.SZ</td>
      <td>奥瑞金</td>
      <td>-8.573562</td>
      <td>-4.928458</td>
      <td>-3.371267</td>
      <td>-1.557191</td>
      <td>-0.503344</td>
      <td>5.600138</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2022-01-25</td>
      <td>128094.SZ</td>
      <td>星帅转债</td>
      <td>002860.SZ</td>
      <td>星帅尔</td>
      <td>-6.923487</td>
      <td>-4.497817</td>
      <td>-3.371267</td>
      <td>-1.126550</td>
      <td>-0.749794</td>
      <td>1.762131</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2022-01-25</td>
      <td>128103.SZ</td>
      <td>同德转债</td>
      <td>002360.SZ</td>
      <td>同德化工</td>
      <td>-9.955257</td>
      <td>-5.529954</td>
      <td>-3.371267</td>
      <td>-2.158687</td>
      <td>-0.258537</td>
      <td>0.802508</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2022-01-25</td>
      <td>128113.SZ</td>
      <td>比音转债</td>
      <td>002832.SZ</td>
      <td>比音勒芬</td>
      <td>-3.660141</td>
      <td>-0.084926</td>
      <td>-3.371267</td>
      <td>3.286341</td>
      <td>0.425414</td>
      <td>2.813844</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 还有一个正股市值没有取出合并
```


```python

```


```python

```


```python

```


```python

```


```python

```
